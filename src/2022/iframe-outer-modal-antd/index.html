<link href="/css/style.css" rel="stylesheet" /><link href="/Blog/css/style.css" rel="stylesheet" /><script src="/assets/post.js" defer></script><script src="/build/post.js" defer></script><script src="/Blog/build/post.js" defer></script><!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<title>iframe é‡Œçš„å¼¹çª—å±•ç¤ºåœ¨æœ€å¤–å±‚</title>
	</head>
<body>
<h1>iframe é‡Œçš„å¼¹çª—å±•ç¤ºåœ¨æœ€å¤–å±‚</h1>

<p><strong>2022.09.25</strong></p>

<p>æˆ‘ä»¬çš„é¡¹ç›®æ˜¯åŸºäºå‰ç«¯å¾®åº”ç”¨çš„æ¶æ„ï¼Œæ¯ä¸€ä¸ªå¾®åº”ç”¨éƒ½ç”¨ iframe åšäº†éš”ç¦»ï¼Œåœ¨å®è·µä¸­æœ‰ä¸€ç§åœºæ™¯ä¹Ÿæ¯”è¾ƒå¸¸è§ï¼Œå°±æ˜¯åƒæ˜¯å¼¹çª—å•Šï¼Œtoast å•Šè¿™ç§é¡µé¢å…¨å±€å±•ç¤ºçš„ï¼Œå°±ä¼šè¢«é™åˆ¶åœ¨ iframe é‡Œé¢ï¼Œå¯¼è‡´é¡µé¢çœ‹ä¸Šå»ä¸åè°ƒï¼Œè¿™é‡Œçœ‹åˆ°ä¸€ç§å†™æ³•ï¼Œæ„Ÿè§‰å¾ˆå¦™ï¼Œæ¥åˆ†äº«ä¸‹ï¼Œ</p>

<p>é¦–å…ˆå› ä¸º same-origin çš„ç­–ç•¥ï¼Œiframe å¦‚æœå’Œå¤–å±‚é¡µé¢æ˜¯ä¸åŒæºçš„è¯ï¼Œé‚£ä¹ˆ iframe æ˜¯æ²¡æœ‰æƒé™è¯»å–å¤–å±‚é¡µé¢çš„ä¸€åˆ‡æ“ä½œçš„ï¼Œé˜²æ­¢å¤–å±‚é¡µé¢ä¿¡æ¯æ³„æ¼ï¼Œä½†æ˜¯ï¼Œæœ‰ä¸€ç§æƒ…å†µä¾‹å¤–ï¼Œå½“ iframe ä¸æ˜¯é€šè¿‡ <code>src</code> å±æ€§åŠ è½½çš„ï¼Œè€Œæ˜¯é€šè¿‡ <code>srcdoc</code> å±æ€§åŠ è½½çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ“ä½œå¤–å±‚é¡µé¢äº†ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è¿›è¡Œè·¨åŸŸæ“ä½œäº†ï¼Œå…¶å®æƒ³æƒ³ä¹Ÿæ­£å¸¸ï¼Œæ¯•ç«Ÿ <code>srcdoc</code> çš„å€¼ä¹Ÿåªèƒ½æ˜¯ä½ è‡ªå·±åŠ çš„äº†ï¼Œæ‰€ä»¥è‚¯å®šå®‰å…¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†å¼¹çª—æ¸²æŸ“åˆ° <code>window.parent.xxx</code> ä¸Šé¢å»äº†ã€‚</p>

<p>ä½†æ˜¯ä¸‹é¢è¦è®²çš„è¿™ç§æ–¹å¼æ„Ÿè§‰æœ‰ç‚¹å–å·§ï¼Œå°±æ˜¯è™½ç„¶å¯ä»¥è¿›è¡Œè·¨åŸŸè®¿é—®å¤–å±‚é¡µé¢äº†ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªååº”ï¼Œæ¯”å¦‚æ˜¯ antd çš„ Modalï¼Œé‚£ä¹ˆå°±ä¼šæƒ³åˆ°ä½¿ç”¨ <code>getContainer</code> è¿™ä¸ª APIï¼Œè€Œä¸ä¼šæƒ³åˆ°ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨å¤–å±‚é¡µé¢ä¸Šå®šä¹‰ antd çš„ <code>Modal</code> ä¸å°±è¡Œäº†å—ï¼Ÿ</p>

<p>æ˜¯ä¸æ˜¯å¾ˆå¦™ï¼Œå¬æ‡‚çš„æŒå£° ğŸ‘</p>

<p>æ•´ä¸ªæºç å°±æ˜¯ä¸‹é¢è¿™ä¸€å—ï¼Œå¯ä»¥åœ¨è¿™é‡Œçœ‹ <a href="https://codesandbox.io/s/portal-antd-uy3ix7?file=/index.html">demo</a>ï¼Œ</p>

<pre><code class="code-highlighted code-js">&lt;<span class="syntax-all syntax-tag">body</span>&gt;
  &lt;<span class="syntax-all syntax-tag">script</span> <span class="syntax-all syntax-entity">src</span><span class="syntax-all syntax-keyword">=</span><span class="syntax-all syntax-string">&quot;https://requirejs.org/docs/release/2.3.6/minified/require.js&quot;</span>&gt;&lt;/<span class="syntax-all syntax-tag">script</span>&gt;
  &lt;<span class="syntax-all syntax-tag">link</span>
    <span class="syntax-all syntax-entity">rel</span><span class="syntax-all syntax-keyword">=</span><span class="syntax-all syntax-string">&quot;stylesheet&quot;</span>
    <span class="syntax-all syntax-entity">href</span><span class="syntax-all syntax-keyword">=</span><span class="syntax-all syntax-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/antd/4.23.2/antd.min.css&quot;</span>
  /&gt;
  &lt;<span class="syntax-all syntax-tag">script</span>&gt;
    requirejs.config({
      <span class="syntax-all syntax-parameter">paths</span><span class="syntax-all syntax-keyword">:</span> {
        <span class="syntax-all syntax-string">antd</span><span class="syntax-all syntax-constant">:</span> <span class="syntax-all syntax-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/antd/4.23.2/antd.min&quot;</span>,
        <span class="syntax-all syntax-string">react</span><span class="syntax-all syntax-constant">:</span>
          <span class="syntax-all syntax-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min&quot;</span>,
        <span class="syntax-all syntax-string">&quot;react-dom&quot;</span>:
          <span class="syntax-all syntax-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min&quot;</span>,
        <span class="syntax-all syntax-string">moment</span><span class="syntax-all syntax-constant">:</span>
          <span class="syntax-all syntax-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min&quot;</span>,
      },
    });
  &lt;/<span class="syntax-all syntax-tag">script</span>&gt;
  &lt;<span class="syntax-all syntax-tag">script</span>&gt;
    globalThis.requirejs(
      [&quot;react&quot;, &quot;react-dom&quot;, &quot;antd&quot;],
      (react, reactDom, antd) =&gt; {
        <span class="syntax-all syntax-parameter">antd</span><span class="syntax-all syntax-keyword">.</span><span class="syntax-all syntax-parameter">message</span><span class="syntax-all syntax-keyword">.</span><span class="syntax-all syntax-variable">success</span>(<span class="syntax-all syntax-string">&quot;from root window&quot;</span>);
      }
    );
  &lt;/<span class="syntax-all syntax-tag">script</span>&gt;
  &lt;<span class="syntax-all syntax-tag">iframe</span>
    <span class="syntax-all syntax-entity">srcdoc</span><span class="syntax-all syntax-keyword">=</span><span class="syntax-all syntax-string">&quot;
</span><span class="syntax-all syntax-string">    &lt;script src=&#39;https://requirejs.org/docs/release/2.3.6/minified/require.js&#39;&gt;&lt;/script&gt;
</span><span class="syntax-all syntax-string">    &lt;link
</span><span class="syntax-all syntax-string">      rel=&#39;stylesheet&#39;
</span><span class="syntax-all syntax-string">      href=&#39;https://cdnjs.cloudflare.com/ajax/libs/antd/4.23.2/antd.min.css&#39;
</span><span class="syntax-all syntax-string">    /&gt;
</span><span class="syntax-all syntax-string">    &lt;body&gt;
</span><span class="syntax-all syntax-string">    &lt;script&gt;
</span><span class="syntax-all syntax-string">      globalThis.requirejs.config({
</span><span class="syntax-all syntax-string">        paths: {
</span><span class="syntax-all syntax-string">          antd: &#39;https://cdnjs.cloudflare.com/ajax/libs/antd/4.23.2/antd.min&#39;,
</span><span class="syntax-all syntax-string">          react:
</span><span class="syntax-all syntax-string">            &#39;https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min&#39;,
</span><span class="syntax-all syntax-string">          &#39;react-dom&#39;:
</span><span class="syntax-all syntax-string">            &#39;https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min&#39;,
</span><span class="syntax-all syntax-string">          moment:
</span><span class="syntax-all syntax-string">            &#39;https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min&#39;,
</span><span class="syntax-all syntax-string">        },
</span><span class="syntax-all syntax-string">      });
</span><span class="syntax-all syntax-string">      globalThis.parent.requirejs(
</span><span class="syntax-all syntax-string">        [&#39;antd&#39;],
</span><span class="syntax-all syntax-string">        (antd) =&gt; {
</span><span class="syntax-all syntax-string">          globalThis.define(&#39;PAntd&#39;, antd)
</span><span class="syntax-all syntax-string">        }
</span><span class="syntax-all syntax-string">      );
</span><span class="syntax-all syntax-string">      setTimeout(() =&gt; {
</span><span class="syntax-all syntax-string">        globalThis.require([&#39;PAntd&#39;], pantd =&gt; {
</span><span class="syntax-all syntax-string">           pantd.message.success(&#39;from inner iframe&#39;);
</span><span class="syntax-all syntax-string">        })
</span><span class="syntax-all syntax-string">        globalThis.require([&#39;antd&#39;], antd =&gt; {
</span><span class="syntax-all syntax-string">           antd.message.success(&#39;from inner iframe&#39;);
</span><span class="syntax-all syntax-string">        })
</span><span class="syntax-all syntax-string">      }, 1000)
</span><span class="syntax-all syntax-string">    &lt;/script&gt;
</span><span class="syntax-all syntax-string">    &lt;/body&gt;
</span><span class="syntax-all syntax-string">    &quot;</span>
  /&gt;
&lt;/<span class="syntax-all syntax-tag">body</span>&gt;</code></pre>

<p>æ ¸å¿ƒä»£ç æ˜¯è¿™å—ï¼Œ</p>

<pre><code class="code-highlighted code-js"><span class="syntax-all syntax-parameter">globalThis</span><span class="syntax-all syntax-keyword">.</span><span class="syntax-all syntax-parameter">parent</span><span class="syntax-all syntax-keyword">.</span><span class="syntax-all syntax-variable">requirejs</span>(
        [<span class="syntax-all syntax-string">&#39;antd&#39;</span>],
        (<span class="syntax-all syntax-parameter">antd</span>) <span class="syntax-all syntax-keyword">=&gt;</span> {
          <span class="syntax-all syntax-parameter">globalThis</span><span class="syntax-all syntax-keyword">.</span><span class="syntax-all syntax-variable">define</span>(<span class="syntax-all syntax-string">&#39;PAntd&#39;</span>, <span class="syntax-all syntax-parameter">antd</span>)
        }
      );</code></pre>

<p>ä¸€å¼€å§‹æˆ‘æ²¡çœ‹æ‡‚ï¼Œåé¢å‘ç°ï¼Œ<code>globalThis.parent.requirejs</code> è¿™ä¸ªæ˜¯å¤–å±‚çš„å†…é¢ï¼Œè¿™æ ·åœ¨ç¬¬ä¸€ä¸ªå…¥å‚æ˜¯ <code>[&#39;antd&#39;]</code> çš„æ—¶å€™ï¼Œå®ƒåªä¼šè§£ææˆä»å¤–å±‚é¡µé¢å®šä¹‰å¥½çš„ <code>antd</code> æ¨¡å—ï¼Œç„¶åæˆ‘ä»¬å†åœ¨ iframe é‡Œä½¿ç”¨ <code>globalThis.define</code> å®šä¸€ä¸ªæ¨¡å—ï¼ŒæŒ‡å‘å¤–å±‚çš„ antd æ¨¡å—ï¼Œè¿™æ ·æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ <code>import { Modal } from &#39;PAntd&#39;</code> å°±èƒ½å®ç°åœ¨å¤–å±‚é¡µé¢å¼¹çª—äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¦™å•Šï¼Œä¸ç”¨å†™ä¸€å †çš„ <code>getContainer</code> äº†ã€‚</p>

<h2>å‚è€ƒ</h2>

<ol>
	<li><a href="https://javascript.info/cross-window-communication">cross-window-communication</a></li>
	<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/domain">document.domain setter deprecated</a></li>
	<li><a href="https://stackoverflow.com/a/41800811">iframe src vs srcdoc</a></li>
</ol>

</body>
</html>

